# 暗号

## 長さ拡張攻撃

https://tryhackme.com/room/lengthextensionattacks

### 条件

1. 元のメッセージのハッシュ値を知っていること
2. 元のメッセージの長さを知っていること（または推測できること）
3. 特定のハッシュ関数のパディングルールがどのように機能するか知っていること

MD5, SHA1 は長さ拡張攻撃に対して脆弱。SHA256は、HMAC等を使用しなければ脆弱。

### hash_extender

[hash_extender](https://github.com/iagox86/hash_extender)

```sh
sudo apt install libssl-dev
git clone https://github.com/iagox86/hash_extender.git
make
```

`H(secret || data)` の形のハッシュであることが、このツールの大前提。  
シークレット長とは、この secret の長さを指す。

```sh
# シークレット長を指定しない
$ hash_extender --data 1.png --signature 02d101c0ac898f9e69b7d6ec1f84a7f0d784e59bbbe057acb4cef2cf93621ba9 --append /../4.png --out-data-format=html
Type: sha256
Secret length: 8
New signature: a9f7878a39b10d0a9d3d1765d3e83dd34b0b0242fa7e1567f085a5a9c467337a
New string: 1%2epng%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00h%2f%2e%2e%2f4%2epng
```

```sh
# シークレット長を指定する
hash_extender --data 'username=user;role=0' --append ';role=1' --signature bfe0fa5c36531773c73dcc8d2a931301f69cf9add05a1f35dcfa2d48b44c37f0 --format sha256 --secret 8 --out-data-format=html
```