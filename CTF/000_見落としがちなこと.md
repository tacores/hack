# 見落としがちなこと

## コマンドインジェクション

- ブラインドインジェクションに注意（sleep, ping, curl などで確認）
- 画面に表示されている項目だけとは限らない（ファイルアップロード時のファイル名など）
- 画面上で特殊文字が消えているように見えても、実行時に消えているとは限らない
- ブラインドで 22, 53, 80, 443, 8080 ポートのアウトバウンドができない場合は、authorized_keys の書き込みを考える

## SQLインジェクション

- `' or 1=1-- -`のような非常に単純な脆弱性であっても、ごく原始的なフィルターが入っているだけでsqlmapは検出できなくなる。そのため手作業での確認も不可欠。

## Windows

- User-Agent をみて、Windowsのときだけ本来の処理をするようなサーバーがある。ブラウザ、Powershell、certutil のUser-Agentを見分ける場合もある。
- Windowsバイナリの解析は、オンラインのサンドボックス解析にアップロードするのが速い。DLLもモードを選べば解析可能。

## ファイルアップロード

- Flask で、画像ファイルアップロードの画面でpyファイルをアップロードしたら実行されるというようなこともあった。

## RCE

- 更新権限のあるpyファイルがAPI呼び出し等のたびにロードされるのは任意コード実行のチャンス（表示文言が設定されているファイルなど）

## パスワード推測

- 複数のパスワードが見えているとき、法則性が無いか注目する。
- ユーザー名のリストだけがあるとき、ユーザー名＝パスワードを探すのも手。
- werkzeug の堅牢なハッシュは、hashcatやjohnではなく、`from werkzeug.security import check_password_hash` でループを回す手もある。
- あるユーザーのパスワードがほかのユーザーでも有効（攻撃者が複数ユーザーを侵害したというストーリーで出てきた）
- NTLMハッシュリストがあるとき、無関係に見えるユーザーのハッシュと一致。

## AWS

- SSRFで、`http://169.254.169.254/latest/meta-data/iam/security-credentials/ec2-instance`, `http://169.254.170.2/v2/metadata` の2か所は確認。後者はAmazon ECS (Elastic Container Service)、あるいは AWS Fargate 上で動作している可能性が高い。
- メタデータにコンテナイメージの識別子が無いか？Publicリポジトリからダウンロード可能ではないか？
