# CVE-2025-50154

```
Windows ファイル エクスプローラーで機密情報が権限のないユーザーに公開されると、権限のない攻撃者がネットワーク上でなりすましを実行できるようになります。
```

https://github.com/rubenformation/CVE-2025-50154

https://cymulate.com/blog/zero-click-one-ntlm-microsoft-security-patch-bypass-cve-2025-50154/

https://cymulate.com/blog/ntlm-leak-cve-2025-59214/

- エクスプローラからSMB接続させることでNTLMハッシュを送信させる攻撃
- Linkのアイコン表示により発生するためノークリックで成立
- CVE-2025-59214 では修正されておらず、新しく CVE-2025-59214 が発番された

## PoC の分析

```ps
# linkオブジェクトを配置するパスを指定
$shortcut = $wShell.CreateShortcut($shortcutPath)
```

```ps
# linkが指し示すバイナリファイルの場所を指定（SMB上）
$shortcut.TargetPath = $targetPath
```

```ps
# アイコンを含むファイルの指定（デフォルトのSHELL32.dll）
$shortcut.IconLocation = $iconLocation
```

linkにローカルのアイコンファイルを指定しているにもかかわらず、エクスプローラがexeファイル内のリソースを取得しに行くために発生する。

## 軽減策

- SMB（TCP 445）を外向けにブロックする。
- SMB署名の有効化／NTLM最小化ポリシーの適用、可能なら NTLM を廃止または制限。
- エンドポイントで不審な .lnk ファイルや外部UNCを含む参照を検知するルール（EDRでの挙動検出）を作る。
- Windows のセキュリティ更新を迅速に適用する。
